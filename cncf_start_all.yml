---
# Copyright 2016 PingCAP, Inc.

# The playbook of TiDB

- name: initializing deployment target
  hosts: all
  gather_facts: true
  roles: []

#- hosts: monitored_servers
#  gather_facts: false
#  tasks:
#    - name: start node_exporter
#      shell: cd {{ deploy_dir }}/scripts && ./stop_{{ item }}.sh; ./start_{{ item }}.sh
#      with_items:
#      - node_exporter

- hosts: monitoring_servers
  gather_facts: false
  tasks:
  - name: start monitoring modules
    shell: cd {{ deploy_dir }}/scripts && ./stop_{{ item }}.sh; ./start_{{ item }}.sh
    with_items:
    - pushgateway
    - prometheus

- hosts: pd_servers
  gather_facts: false
  tasks:
  - name: start PD
    shell: cd {{ deploy_dir }}/scripts && ./stop_{{ item }}.sh; ./start_{{ item }}.sh
    with_items:
    - pd

- hosts: tikv_servers
  gather_facts: false
  tasks:
  - name: start TiKV
    shell: cd {{ deploy_dir }}/scripts && ./stop_{{ item }}.sh; ./start_{{ item }}.sh
    with_items:
    - tikv


- hosts: tidb_servers
  gather_facts: false
  tasks:
  - name: start TiDB
    shell: cd {{ deploy_dir }}/scripts && ./stop_{{ item }}.sh; ./start_{{ item }}.sh
    with_items:
    - tidb
