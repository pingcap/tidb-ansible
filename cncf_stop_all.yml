---
# Copyright 2016 PingCAP, Inc.

# The playbook of TiDB

- name: initializing deployment target
  hosts: all
  gather_facts: true
  roles: []

- hosts: monitored_servers
  gather_facts: false
  tasks:
    - name: restart node_exporter
      shell: cd {{ deploy_dir }}/scripts && ./stop_{{ item }}.sh;
      with_items:
      - node_exporter
      ignore_errors: true


- hosts: monitoring_servers
  gather_facts: false
  tasks:
  - name: restart monitoring modules
    shell: cd {{ deploy_dir }}/scripts && ./stop_{{ item }}.sh;
    with_items:
    - pushgateway
    - prometheus
#    - grafana


- hosts: pd_servers
  gather_facts: false
  tasks:
  - name: restart PD
    shell: cd {{ deploy_dir }}/scripts && ./stop_{{ item }}.sh;
    with_items:
    - pd

- hosts: tikv_servers
  gather_facts: false
  tasks:
  - name: restart TiKV
    shell: cd {{ deploy_dir }}/scripts && ./stop_{{ item }}.sh;
    with_items:
    - tikv


- hosts: tidb_servers
  gather_facts: false
  tasks:
  - name: restart TiDB
    shell: cd {{ deploy_dir }}/scripts && ./stop_{{ item }}.sh;
    with_items:
    - tidb
