---
# Copyright 2016 PingCAP, Inc.
# The Playbook of TiDB

# basic kernel parameter & monitoring

- name: initializing deployment target
  hosts: all
  gather_facts: true
  roles:
  - common

#- name: deploying monitoring agent
#  hosts: monitored_servers
#  gather_facts: false
#  roles:
#  - { role: node_exporter, when: "groups.monitoring_servers | default(False)" }

- name: deploying monitoring server
  hosts: monitoring_servers
  gather_facts: false
  roles:
  - pushgateway
#  - prometheus
#  - grafana

# deploying TiDB cluster

- name: deploying PD cluster
  hosts: pd_servers
  gather_facts: false
  roles:
  - pd

- name: deploying TiKV cluster
  hosts: tikv_servers
  gather_facts: false
  roles:
  - tikv

- name: deploying TiDB cluster
  hosts: tidb_servers
  gather_facts: false
  roles:
#  - pump
  - tidb


- name: finalizing deployment target
  hosts: all
  gather_facts: false
  roles:
  - firewalld

#- name: deploying binlog server
#  hosts: binlog_servers
#  roles:
#  - cistern
#  - drainer

#- name: deploying load balance server
#  hosts: lb_servers
#  roles:
#  - haproxy
