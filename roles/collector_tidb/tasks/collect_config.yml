---

- name: check pd config directory
  stat: path={{ tidb_conf_dir | default(deploy_dir'/conf') }} get_md5=false get_checksum=false
  register: conf_dir_st

- fail:
    msg: "{{ tidb_conf_dir | default(deploy_dir'/conf') }} must exist and is a directory"
  when: conf_dir_st.stat.isdir is not defined or conf_dir_st.stat.isdir == False

- name: collect tidb config
  shell: "python {{ collector_dir }}/scripts/tidb-insight/insight.py -l --config-dir={{ tidb_conf_dir | default(deploy_dir'/conf') }} --config-prefix=pd --output={{ deploy_dir }} --alias={{ inventory_hostname }}"
