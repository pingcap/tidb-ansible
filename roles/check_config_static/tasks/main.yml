---
# Common Tasks



- name: Ensure only one monitoring host exists
  fail: msg="One, or no monitoring host may be specified. Primaries {{ groups['monitoring_server] }}"
  when: "groups.get('monitoring_servers', [])|length > 1"

- name: Ensure TiDB host exists
  fail: msg="One, or more tidb hosts may be specified. hosts {{ groups['tidb_servers'] }}"
  when: "groups['tidb_servers'] is defined and groups['tidb_servers']|length < 1"

- name: Ensure PD host exists
  fail: msg="One, or more pd hosts may be specified. hosts {{ groups['pd_servers'] }}"
  when: "groups['pd_servers'] is defined and groups['pd_servers']|length < 1"

- name: Ensure TiKV host exists
  fail: msg="One, or more tikv hosts may be specified. hosts {{ groups['tikv_servers'] }}"
  when: "groups['tikv_servers'] is defined and groups['tikv_servers']|length < 1"

- name: Ensure Binlog is disabled
  fail: msg="Binlog deployment is not supported yet. pump/cistern/drainer will not be deployed."
  when: enable_binlog